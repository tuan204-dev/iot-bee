<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Realtime Dashboard</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }

        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .status-panel {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .sensor-card {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #444;
            transition: all 0.3s ease;
        }

        .sensor-card.updated {
            border-color: #00ff00;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        .sensor-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .sensor-value {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }

        .sensor-unit {
            font-size: 14px;
            color: #ccc;
        }

        .sensor-timestamp {
            font-size: 12px;
            color: #888;
            margin-top: 10px;
        }

        .log-panel {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 5px;
            font-family: monospace;
            font-size: 12px;
        }

        .log-timestamp {
            color: #666;
        }

        .log-data {
            color: #00ff00;
        }

        .connected {
            color: #00ff00;
        }

        .disconnected {
            color: #ff0000;
        }
    </style>
</head>

<body>
    <div class="dashboard">
        <div class="header">
            <h1>üè† IoT Real-time Dashboard</h1>
            <div class="status-panel">
                <span id="connection-status" class="disconnected">‚ùå Disconnected</span>
                <span id="client-info"></span>
            </div>
        </div>

        <div class="sensor-grid">
            <div class="sensor-card" id="temperature-card">
                <div class="sensor-icon">üå°Ô∏è</div>
                <div class="sensor-value" id="temperature-value">--</div>
                <div class="sensor-unit">¬∞C</div>
                <div class="sensor-timestamp" id="temperature-time">--</div>
            </div>

            <div class="sensor-card" id="humidity-card">
                <div class="sensor-icon">üíß</div>
                <div class="sensor-value" id="humidity-value">--</div>
                <div class="sensor-unit">%</div>
                <div class="sensor-timestamp" id="humidity-time">--</div>
            </div>

            <div class="sensor-card" id="light-card">
                <div class="sensor-icon">üí°</div>
                <div class="sensor-value" id="light-value">--</div>
                <div class="sensor-unit">lux</div>
                <div class="sensor-timestamp" id="light-time">--</div>
            </div>
        </div>

        <div class="log-panel">
            <h3>üìä Real-time Data Log</h3>
            <div id="data-log"></div>
        </div>
    </div>

    <script>
        // Connect to WebSocket server
        const socket = io('http://localhost:8000/realtime');
        const log = document.getElementById('data-log');

        function addLogEntry(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span> <span class="log-data">${message}</span>`;
            log.insertBefore(entry, log.firstChild);

            // Keep only last 50 entries
            while (log.children.length > 50) {
                log.removeChild(log.lastChild);
            }
        }

        function updateSensorCard(type, value, unit = '') {
            const card = document.getElementById(`${type}-card`);
            const valueElement = document.getElementById(`${type}-value`);
            const timeElement = document.getElementById(`${type}-time`);

            valueElement.textContent = value;
            timeElement.textContent = new Date().toLocaleTimeString();

            // Add update animation
            card.classList.add('updated');
            setTimeout(() => card.classList.remove('updated'), 2000);
        }

        // Connection events
        socket.on('connect', () => {
            document.getElementById('connection-status').innerHTML = '‚úÖ <span class="connected">Connected</span>';
            addLogEntry('üîå Connected to WebSocket server', 'success');
        });

        socket.on('disconnect', () => {
            document.getElementById('connection-status').innerHTML = '‚ùå <span class="disconnected">Disconnected</span>';
            addLogEntry('üîå Disconnected from server', 'error');
        });

        socket.on('connection_status', (data) => {
            document.getElementById('client-info').textContent = `Client ID: ${data.clientId}`;
            addLogEntry(`üìù Client registered: ${data.clientId}`, 'info');
        });

        // Sensor data events
        socket.on('sensor_data', (data) => {
            addLogEntry(`üìä Full sensor data: T=${data.temp}¬∞C, H=${data.humidity}%, L=${data.light} lux`);
            updateSensorCard('temperature', data.temp, '¬∞C');
            updateSensorCard('humidity', data.humidity, '%');
            updateSensorCard('light', data.light, 'lux');
        });

        socket.on('temperature', (data) => {
            updateSensorCard('temperature', data.value, data.unit);
            addLogEntry(`üå°Ô∏è Temperature: ${data.value}${data.unit}`);
        });

        socket.on('humidity', (data) => {
            updateSensorCard('humidity', data.value, data.unit);
            addLogEntry(`üíß Humidity: ${data.value}${data.unit}`);
        });

        socket.on('light', (data) => {
            updateSensorCard('light', data.value, data.unit);
            addLogEntry(`üí° Light: ${data.value} ${data.unit}`);
        });

        socket.on('system_notification', (data) => {
            addLogEntry(`üì¢ System: ${data.message} (${data.level})`, data.level);
        });

        // Initial log entry
        addLogEntry('üöÄ Dashboard initialized, waiting for connection...');
    </script>
</body>

</html>